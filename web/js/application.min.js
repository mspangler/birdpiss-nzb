var contentTbl,mediaUrl='server/process.php';function setupUI(){setupLayout();setupTable();setupDownloadDialog();setupUploadDialog();}
function setupLayout(){$('body').layout({west__showOverflowOnHover:true,resizable:false,closable:false});$('.ui-layout-west a').click(function(){var txt=$(this).text();if(txt=='Upload'){$('#uploadForm :input').val('');$('#errorBox').html('');$('#uploadDialog').dialog('open');}else{$('.ui-layout-west a').removeClass('selectedCat');$(this).addClass('selectedCat');getContent(txt);}
return false;});$(".ui-layout-west a:contains('Movies')").addClass('selectedCat');}
function setupTable(){$('tbody').html('');contentTbl=$('#contentTbl').dataTable({bPaginate:true,bLengthChange:false,bAutoWidth:false,iDisplayLength:25,sPaginationType:'full_numbers',bSortClasses:false,bProcessing:true,aaSorting:[],bStateSave:false,sAjaxSource:mediaUrl+'?type=movies',fnInitComplete:function(){hideAjaxLoader();},oLanguage:{sSearch:'Search:',sZeroRecords:'No files found',sInfo:'Showing _START_ to _END_ of _TOTAL_ files'},aoColumns:[{bVisible:false,bSearchable:false},{sTitle:'Title'},{sTitle:'Newsgroup'},{sTitle:'Submitted By'},{sTitle:'Size'},{sTitle:'Age'}]});setupRowEvents();showAjaxLoader();$('#contentTbl_filter :text:first').addClass('ui-widget input nzbSearch').attr('size',50).focus();$('#contentTbl_filter').append('&nbsp;<input type="submit" value="Download Selected" id="downloadBtn" class="ui-widget-content nzbBtn" />');$('#downloadBtn').click(function(){var selectedRows=getSelectedRows();if(selectedRows.length>0){$('#downloadDialog').dialog('open');}else{$('#invalidDownloadDialog').dialog('open');}});}
function setupRowEvents(){$('#contentTbl tbody tr').live('mouseover',(function(){if(!$(this).hasClass('selected')){$(this).addClass('hover');}}));$('#contentTbl tbody tr').live('mouseout',(function(){if(!$(this).hasClass('selected')){$(this).removeClass('hover');}}));$('#contentTbl tbody tr').live('click',(function(){if(!$(this).hasClass('selected')){$(this).addClass('selected');$(this).removeClass('hover');}else{$(this).removeClass('selected');}}));}
function getSelectedRows(){var selectedRows=[],tblRows=contentTbl.fnGetNodes(),data,j=0;for(var i=0;i<tblRows.length;i++){if($(tblRows[i]).hasClass('selected')){data=contentTbl.fnGetData(i);selectedRows[j]=data[0];j++;}}
return selectedRows;}
function clearSelectedRows(){var tblRows=contentTbl.fnGetNodes();for(var i=0;i<tblRows.length;i++){if($(tblRows[i]).hasClass('selected')){$(tblRows[i]).removeClass('selected');}}}
function setupDownloadDialog(){$('#downloadDialog').dialog({modal:true,autoOpen:false,width:'350px',title:'Please enjoy this tasty file',buttons:{Download:function(){$(this).dialog('close');alert("You would've downloaded the following ids: "+getSelectedRows());clearSelectedRows();}}});$('#invalidDownloadDialog').dialog({autoOpen:false,modal:true,title:'Download Fail'});}
function setupUploadDialog(){$('#uploadForm :input').val('');$('#size').numeric({allow:'.'});$('#uploadDialog').dialog({modal:true,autoOpen:false,title:'Thanks for sharing',width:'450px',buttons:{Upload:function(){$('#uploadForm').submit();}}});$('#uploadForm').validate({errorClass:'important',errorLabelContainer:'#errorBox',wrapper:'li',rules:{usenet_file:'required',title:'required',media:'required',newsgroup:'required',size:'required'},messages:{usenet_file:'File fail',title:'Title fail',media:'Media fail',newsgroup:'Newsgroup fail',size:'Size fail'}});}
function getContent(type){showAjaxLoader();contentTbl.fnClearTable();$.getJSON(mediaUrl,{type:type.toLowerCase()},function(data){contentTbl.fnAddData(data.aaData);hideAjaxLoader();});}
function showAjaxLoader(){$('#contentTbl_processing').attr('style','visibility:visible;').html('<img src="css/images/ajax-loader.gif" alt="Shovelling coal into the server..." />');}
function hideAjaxLoader(){$('#contentTbl_processing').attr('style','visibility:hidden;');}
